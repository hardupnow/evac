<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>evac.lazy.lazyensemble module &#8212; evac 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="evac.lazy.lazywrf module" href="evac.lazy.lazywrf.html" />
    <link rel="prev" title="evac.lazy.ideal_profiles module" href="evac.lazy.ideal_profiles.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><img class="rightlogo" src="_static/evac_logo.png" alt="Logo"/><h1 class="heading"><a href="index.html">
          <span>evac 0.1.0 documentation</span></a></h1>
        <h2 class="heading"><span>evac.lazy.lazyensemble module</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="evac.lazy.ideal_profiles.html">evac.lazy.ideal_profiles module</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="evac.lazy.lazywrf.html">evac.lazy.lazywrf module</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="module-evac.lazy.lazyensemble">
<span id="evac-lazy-lazyensemble-module"></span><h1>evac.lazy.lazyensemble module<a class="headerlink" href="#module-evac.lazy.lazyensemble" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="evac.lazy.lazyensemble.LazyEnsemble">
<em class="property">class </em><code class="descclassname">evac.lazy.lazyensemble.</code><code class="descname">LazyEnsemble</code><span class="sig-paren">(</span><em>path_to_exedir</em>, <em>path_to_datadir</em>, <em>path_to_namelistdir</em>, <em>path_to_icdir</em>, <em>path_to_lbcdir</em>, <em>path_to_outdir</em>, <em>path_to_batch</em>, <em>initutc</em>, <em>sched='slurm'</em>, <em>path_to_rundir=False</em>, <em>delete_exe_copy=False</em>, <em>ndoms=1</em>, <em>nmems=0</em>, <em>membernames=False</em>, <em>endutc=False</em>, <em>runsec=False</em>, <em>nl_per_member=True</em>, <em>nl_suffix='name'</em>, <em>ics=None</em>, <em>lbcs=None</em>, <em>dryrun=False</em>, <em>rename_d01_ics=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Generate ensemble by running multiple WRF runs simulataneously.</p>
<p>This is done by creating temporary folder and linking/copying, with
efficiency improvements from Monte Flora. Will not work on Windows systems
as it stands, due to hardcoded PosixPath.</p>
<p>User must specify either endutc or runsec.</p>
<p>The initial and boundary conditions are copied from path_to_icbcdir
to path_to_rundir, using default names.</p>
<p>Member names, if automatically created, are &#8220;mem01&#8221;, &#8220;mem02&#8221;, etc</p>
<p class="rubric">Example</p>
<p>Parent script should be run via batch submission. The procedure is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="n">LazyEnsemble</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">run_all_members</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that WRF can run with initial and boundary conditions from
only the parent domain (d01).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>path_to_exedir</strong> &#8211; (str) - directory of compiled WRF executables</li>
<li><strong>path_to_datadir</strong> &#8211; (str) - directory where wrfout and other data
will be saved.</li>
<li><strong>path_to_namelistdir</strong> &#8211; (str) - directory containing namelist(s)
templates or full versions.</li>
<li><strong>path_to_icdir</strong> &#8211; (str,bool) - directory with initial conditions
If False, don&#8217;t copy any ICs.</li>
<li><strong>path_to_lbcdir</strong> &#8211; (str,bool) - directory with boundary conditions
If False, don&#8217;t copy any LBCss.</li>
<li><strong>path_to_outdir</strong> &#8211; (str) - where to move wrfout files to</li>
<li><strong>path_to_batch</strong> &#8211; (str) - absolute path to <a href="#id1"><span class="problematic" id="id2">*</span></a>.job script
for slurm - not sure about rocks etc</li>
<li><strong>initutc</strong> &#8211; (datetime.datetime) - initialisation time</li>
<li><strong>path_to_rundir</strong> &#8211; (str, optional) - directory where wrf.exe will
be copied to,
and rsl.error files will be generated.
By default, this is the datadir.
If running multiple ensembles, it is
faster to have permanant folders for each
ensemble, rather than spinning up and
deleting wrf.exe)</li>
<li><strong>sched</strong> &#8211; (str, optional) - job scheduler.
Only implemented for slurm right now</li>
<li><strong>delete_exe_copy</strong> &#8211; (bool, optional) - whether the .exe files
will be deleted after the run is finished.
The default is no, as numerous ensembles
can use the same run folders, potentially.</li>
<li><strong>ndoms</strong> &#8211; (int) - number of domains</li>
<li><strong>nmems</strong> &#8211; (int) - number of members. If zero,
try counting length of membernames.</li>
<li><strong>membernames</strong> &#8211; (list,tuple) - list of strings for
member names. If False, use automatic</li>
<li><strong>endutc</strong> &#8211; (datetime.datetime) - time to end simulation</li>
<li><strong>runsec</strong> &#8211; (int) - seconds of simulation time</li>
<li><strong>nl_per_member</strong> &#8211; (bool) - if True, each member has their
own namelist file in path_to_namelistdir,
where each member&#8217;s namelist is the file
namelist.input.&lt;nl_suffix&gt; - see next</li>
<li><strong>nl_suffix</strong> &#8211; (str) - if &#8216;name&#8217;, the suffix will be the
member name (either passed in or automatically
generated).</li>
<li><strong>ics</strong><strong>,</strong><strong>lbcs</strong> &#8211; <p>(dict,list,bool) - filename of IC/LBC files.</p>
<p>if dictionary, format is {member :{(from,to):cmd)
where cmd is &#8220;move&#8221;, &#8220;copy&#8221;, or &#8220;softlink&#8221;, and
to/from are the absolute paths</p>
<p>If a list, this is used for each ensemble
member from a folder within icdir and
lbcdir, respectively.</p>
<p>If True, it looks for the default names
in subfolders of icdir and lbcdir</p>
<p>if &#8216;all&#8217;, it copies everything from the
default folders.</p>
<p>if any other string, it glob-matches
ics/lbcs and imports all matches.</p>
</li>
<li><strong>dryrun</strong> &#8211; (bool) - if True, don&#8217;t delete any files
or submit any runs.</li>
<li><strong>rename_d01_ics</strong> &#8211; (bool) - if True, rename d01 ICs to
wrfinput_d01. Only works if only the
d01 domain has ICs.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.aa_test">
<code class="descname">aa_test</code><span class="sig-paren">(</span><em>param1</em>, <em>param2=2</em>, <em>param3=('hi'</em>, <em>'there')</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.aa_test"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.aa_test" title="Permalink to this definition">¶</a></dt>
<dd><p>Example of docstring on the __init__ method.</p>
<p>The __init__ method may be documented in either the class level
docstring, or as a docstring on the __init__ method itself.</p>
<p>Either form is acceptable, but the two should not be mixed. Choose one
convention to document the __init__ method and be consistent with it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do not include the <cite>self</cite> parameter in the <code class="docutils literal"><span class="pre">Args</span></code> section.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>param1</strong> (<em>str</em>) &#8211; Description of <cite>param1</cite>.</li>
<li><strong>param2</strong> (<code class="xref py py-obj docutils literal"><span class="pre">int</span></code>, optional) &#8211; Description of <cite>param2</cite>. Multiple
lines are supported.</li>
<li><strong>param3</strong> (<em>list</em><em>(</em><em>str</em><em>)</em><em></em>) &#8211; Description of <cite>param3</cite>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.batchscript_for_member">
<code class="descname">batchscript_for_member</code><span class="sig-paren">(</span><em>member</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.batchscript_for_member"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.batchscript_for_member" title="Permalink to this definition">¶</a></dt>
<dd><p>Edit parts of the batch submission script.</p>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.catalog_members">
<code class="descname">catalog_members</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.catalog_members"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.catalog_members" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the members dictionary.</p>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.check_complete">
<code class="descname">check_complete</code><span class="sig-paren">(</span><em>member</em>, <em>raise_error=False</em>, <em>sleep=30</em>, <em>firstwait=3600</em>, <em>maxtime=86400</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.check_complete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.check_complete" title="Permalink to this definition">¶</a></dt>
<dd><p>Check ensemble member to see if wrf run has finished.</p>
<p>Returns:
True if WRF exits successfully.
False if not (and if raise_error is False, otherwise Exception)
Does not exit, if maxtime is N.inf and if WRF does not exit</p>
<p>Args:
raise_error     :   (bool) - if True, pass a WRFError as return</p>
<blockquote>
<div>if WRF breaks.</div></blockquote>
<p>sleep           :   (int) - number of seconds to wait between checks
firstwait       :   (int) - number of seconds to wait after submission</p>
<blockquote>
<div>before checks</div></blockquote>
<dl class="docutils">
<dt>maxtime</dt>
 <span class="classifier-delimiter">:</span> <span class="classifier">(int) - number of seconds after which the</span><dd>method will assume the member&#8217;s run has died.
If this is infinity, script will NEVER DIE!</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.cleanup">
<code class="descname">cleanup</code><span class="sig-paren">(</span><em>folder</em>, <em>files</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.cleanup"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.cleanup" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes files in given directory that match a glob.</p>
<p>Args:</p>
<p>folder      :   (path-like object) - this is where to clean up.
files       :   (str,list,tuple) - a list of strings, or a string,</p>
<blockquote>
<div>to match glob. For instance, &#8220;rsl*&#8221;.</div></blockquote>
</dd></dl>

<dl class="staticmethod">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.edit_batchscript">
<em class="property">static </em><code class="descname">edit_batchscript</code><span class="sig-paren">(</span><em>fpath</em>, <em>linekey</em>, <em>newline</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.edit_batchscript"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.edit_batchscript" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace a line from the submission script
that matches a key (linekey) with newline.</p>
<p>linekey must be unambiguous, otherwise it will change the
first occurence in the file that matches.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.ensure_permissions">
<em class="property">static </em><code class="descname">ensure_permissions</code><span class="sig-paren">(</span><em>fpath</em>, <em>perm_decimal=755</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.ensure_permissions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.ensure_permissions" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes sure the scheduler can run the executable at fpath.</p>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.get_paths_to_input">
<code class="descname">get_paths_to_input</code><span class="sig-paren">(</span><em>userinput</em>, <em>opt</em>, <em>fname_warning=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.get_paths_to_input"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.get_paths_to_input" title="Permalink to this definition">¶</a></dt>
<dd><p>Logic to add absolute paths of ICs or LBCs to the dictionary.</p>
<p>Args:</p>
<p>userinput   :   ics or lbcs from __init__.
opt         :   (str) - &#8216;ics&#8217; or &#8216;lbcs&#8217;
fname_warning   :   (bool) - if True, raise Exception if</p>
<blockquote>
<div>the IC/LBC files do not follow the
convention for the wrf run directory</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.namelist_for_member">
<code class="descname">namelist_for_member</code><span class="sig-paren">(</span><em>member</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.namelist_for_member"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.namelist_for_member" title="Permalink to this definition">¶</a></dt>
<dd><p>Edit parts of the namelist</p>
<p>start/end year, month, day, hour, minute, second</p>
<p>Use multiplied notation by number of domains (self.ndoms)</p>
<p>Assume that everything else in namelist is correct for member</p>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.print_readme">
<code class="descname">print_readme</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.print_readme"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.print_readme" title="Permalink to this definition">¶</a></dt>
<dd><p>Save a pretty-printed README file to a given directory.</p>
<p>Optional argument will print namelist.input</p>
<p>Maybe this could be a decorator method that logs this data for each
ensemble member.</p>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.run_all_members">
<code class="descname">run_all_members</code><span class="sig-paren">(</span><em>prereqs</em>, <em>first=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.run_all_members"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.run_all_members" title="Permalink to this definition">¶</a></dt>
<dd><p>Automatically submit all jobs to the scheduler.
See run_wrf_member() and check_complete() for keyword arguments.</p>
<p>Args:
prereqs :   (dict) - a dictionary containing prerequisite files</p>
<blockquote>
<div><p>needed in rundir. use this format:</p>
<p>dict( path_to_file = cmd)</p>
<p>where path_to_file is the absolute path to
the file in question (as str or Path obj) and
cmd is from [&#8216;copy&#8217;,&#8217;move&#8217;,&#8217;softlink&#8217;].</p>
<p>Don&#8217;t include initial, boundary conditions (these are
different for every member and are copied automatically)
or namelist files (ditto).</p>
</div></blockquote>
<p>first       :   (int) - only run the first x members
kwargs      :   keyword arguments passed to run_wrf_member.</p>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.run_real_member">
<code class="descname">run_real_member</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.run_real_member"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.run_real_member" title="Permalink to this definition">¶</a></dt>
<dd><p>Submit real.exe to batch scheduler.</p>
</dd></dl>

<dl class="method">
<dt id="evac.lazy.lazyensemble.LazyEnsemble.run_wrf_member">
<code class="descname">run_wrf_member</code><span class="sig-paren">(</span><em>member</em>, <em>prereqs</em>, <em>cpus=1</em>, <em>nodes=1</em>, <em>sleep=30</em>, <em>firstwait=3600</em>, <em>maxtime=86400</em>, <em>check=False</em>, <em>rename_dict=None</em>, <em>merge_lbcs=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/evac/lazy/lazyensemble.html#LazyEnsemble.run_wrf_member"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#evac.lazy.lazyensemble.LazyEnsemble.run_wrf_member" title="Permalink to this definition">¶</a></dt>
<dd><p>Submit a wrf run to batch scheduler.</p>
<p>member  :   (str) - name of member to run</p>
</dd></dl>

</dd></dl>

</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="evac.lazy.ideal_profiles.html">evac.lazy.ideal_profiles module</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="evac.lazy.lazywrf.html">evac.lazy.lazywrf module</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, John Lawson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>